<!DOCTYPE html> 
<html lang="ar" dir="rtl"> 
<head> 
<meta charset="UTF-8"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0"> 
<title>Leo TV</title> 
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"> 
<link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@1.4.10/dist/hls.min.js"></script>
<style> 
:root {
    --primary-color: #F7B72D;
    --primary-dark: #d89a15;
    --light-bg: #ffffff;
    --dark-bg: #000000;
    --light-card: #ffffff;
    --dark-card: #1a1a1a;
    --text-light: #000000;
    --text-dark: #ffffff;
    --border-light: #e0e0e0;
    --border-dark: #333333;
    --shadow-light: rgba(0, 0, 0, 0.1);
    --shadow-dark: rgba(0, 0, 0, 0.3);
    --hover-light: #f8f9fa;
    --hover-dark: #2a2a2a;
}

* {margin:0; padding:0; box-sizing:border-box;} 
body {font-family: 'Almarai', Arial, sans-serif; background:var(--light-bg); color:var(--text-light); padding-top:60px; padding-bottom:60px; direction:rtl; transition: all 0.3s ease;} 
body.dark-mode {background:var(--dark-bg); color:var(--text-dark);} 

.top-bar {
    position:fixed; 
    top:0; 
    left:0; 
    width:100%; 
    height:60px; 
    background:var(--light-bg); 
    display:flex; 
    justify-content:center; 
    align-items:center; 
    border-bottom:2px solid var(--primary-color);
    z-index:1000;
    box-shadow: 0 2px 10px var(--shadow-light);
} 
.top-bar h1 {
    font-size:24px; 
    font-weight:700;
    background: linear-gradient(90deg, var(--primary-color), var(--primary-dark));
    -webkit-background-clip: text; 
    -webkit-text-fill-color: transparent;
} 
body.dark-mode .top-bar {
    background:var(--dark-bg); 
    border-bottom-color: var(--primary-color);
    box-shadow: 0 2px 10px var(--shadow-dark);
}

.slider-container {
    position:relative; 
    width:100%; 
    overflow-x:auto; 
    display:flex; 
    scroll-snap-type:x mandatory; 
    -webkit-overflow-scrolling:touch;
    margin-top:10px;
} 
.slide {min-width:100%; height:200px; scroll-snap-align:start;} 
.slide img {width:100%; height:100%; object-fit:cover; border-radius:8px;} 
.slider-container::-webkit-scrollbar {display:none;} 
.slider-dots {text-align:center; margin-top:8px;} 
.dot {display:inline-block;width:10px;height:10px;margin:0 4px;background:#ddd;border-radius:50%;cursor:pointer;} 
.dot.active {background:var(--primary-color);} 

.channel-section {margin:20px 10px;} 
.channel-section h2 {
    font-size:18px; 
    margin-bottom:10px;
    color: var(--text-light);
    padding-bottom:5px;
    border-bottom:2px solid var(--primary-color);
} 
body.dark-mode .channel-section h2 {
    color: var(--text-dark);
}

.channels {display:flex; gap:10px; overflow-x:auto; scroll-behavior:smooth; padding:10px 5px;} 
.channels::-webkit-scrollbar {display:none;} 
.channel-card {
    flex:0 0 auto; 
    width:200px; 
    background:var(--light-card); 
    border-radius:12px; 
    overflow:hidden; 
    text-align:center; 
    box-shadow:0 4px 12px var(--shadow-light);
    border:1px solid var(--border-light);
    transition: all 0.3s ease;
} 
.channel-card:hover {
    transform: translateY(-5px);
    box-shadow:0 8px 20px var(--shadow-light);
    border-color:var(--primary-color);
}
.channel-card img {
    width:100%; 
    height:120px; 
    object-fit:cover;
    border-bottom:2px solid var(--primary-color);
} 
.channel-card p {
    padding:10px; 
    font-size:14px;
    font-weight:600;
    color: var(--text-light);
} 
body.dark-mode .channel-card {
    background:var(--dark-card); 
    border-color:var(--border-dark);
    box-shadow:0 4px 12px var(--shadow-dark);
}
body.dark-mode .channel-card:hover {
    box-shadow:0 8px 20px var(--shadow-dark);
}
body.dark-mode .channel-card p {
    color:var(--text-dark);
}

.bottom-bar {
    position:fixed; 
    bottom:0; 
    left:0; 
    width:100%; 
    height:60px; 
    background:var(--light-bg); 
    display:flex; 
    justify-content:space-around; 
    align-items:center; 
    border-top:2px solid var(--primary-color);
    z-index:1000;
    box-shadow: 0 -2px 10px var(--shadow-light);
} 
body.dark-mode .bottom-bar {
    background:var(--dark-bg);
    box-shadow: 0 -2px 10px var(--shadow-dark);
}
.tab-btn {
    background:none; 
    border:none; 
    color:var(--text-light);
    display:flex; 
    flex-direction:column; 
    align-items:center; 
    font-size:12px; 
    cursor:pointer; 
    width:100%; 
    height:100%; 
    justify-content:center;
    transition: all 0.3s ease;
} 
.tab-btn i {
    font-size:22px; 
    margin-bottom:3px;
    transition: all 0.3s ease;
}
body.dark-mode .tab-btn {color:var(--text-dark);} 
.tab-btn.active {
    color:var(--primary-color);
}
.tab-btn.active i {
    transform: scale(1.1);
}
.tab-btn:hover {
    color:var(--primary-color);
}

.page {display:none; padding:20px; min-height: calc(100vh - 120px);} 
#home-page {display:block;} 

.vod-page {
    padding: 20px;
    background: var(--light-bg);
    transition: background 0.3s;
}
body.dark-mode .vod-page {
    background: var(--dark-bg);
}

.search-box {
    margin-bottom: 20px;
    position: relative;
}
.search-input {
    width: 100%;
    padding: 14px 20px 14px 50px;
    border-radius: 12px;
    background: var(--light-card);
    border: 2px solid var(--border-light);
    color: var(--text-light);
    font-family: 'Almarai', sans-serif;
    font-size: 16px;
    transition: all 0.3s;
}
body.dark-mode .search-input {
    background: var(--dark-card);
    color: var(--text-dark);
    border-color: var(--border-dark);
}
.search-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 15px rgba(247, 183, 45, 0.3);
}
.search-input::placeholder {
    color: rgba(0,0,0,0.5);
}
body.dark-mode .search-input::placeholder {
    color: rgba(255,255,255,0.5);
}
.search-icon {
    position: absolute;
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--primary-color);
    font-size: 18px;
}

.tabs-container {
    margin-bottom: 20px;
}
.tabs {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding: 10px 0;
}
.tabs::-webkit-scrollbar {
    display: none;
}
.vod-tab-btn {
    padding: 12px 24px;
    border-radius: 12px;
    background: var(--light-card);
    border: 2px solid var(--border-light);
    color: var(--text-light);
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.3s;
    font-family: 'Almarai', sans-serif;
    font-size: 16px;
    flex-shrink: 0;
    font-weight: 600;
}
body.dark-mode .vod-tab-btn {
    background: var(--dark-card);
    color: var(--text-dark);
    border-color: var(--border-dark);
}
.vod-tab-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px var(--shadow-light);
    border-color: var(--primary-color);
}
body.dark-mode .vod-tab-btn:hover {
    box-shadow: 0 5px 15px var(--shadow-dark);
}
.vod-tab-btn.active {
    background: var(--primary-color);
    color: var(--dark-bg);
    border-color: var(--primary-color);
    font-weight: 700;
}

.categories-container {
    margin-bottom: 20px;
}
.categories {
    display: flex;
    gap: 10px;
    overflow-x: auto;
    padding: 10px 0;
}
.categories::-webkit-scrollbar {
    display: none;
}
.cat-btn {
    padding: 10px 20px;
    border-radius: 12px;
    background: var(--light-card);
    border: 2px solid var(--border-light);
    color: var(--text-light);
    cursor: pointer;
    white-space: nowrap;
    transition: all 0.3s;
    font-family: 'Almarai', sans-serif;
    font-size: 14px;
    flex-shrink: 0;
    font-weight: 600;
}
body.dark-mode .cat-btn {
    background: var(--dark-card);
    color: var(--text-dark);
    border-color: var(--border-dark);
}
.cat-btn:hover {
    transform: translateY(-2px);
    border-color: var(--primary-color);
}
.cat-btn.active {
    background: var(--primary-color);
    color: var(--dark-bg);
    border-color: var(--primary-color);
    font-weight: 700;
}

.content-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 15px;
}
.vod-card {
    background: var(--light-card);
    border-radius: 12px;
    padding: 12px;
    cursor: pointer;
    transition: all 0.3s;
    border: 2px solid var(--border-light);
    text-align: center;
    box-shadow: 0 4px 12px var(--shadow-light);
    position: relative;
}
body.dark-mode .vod-card {
    background: var(--dark-card);
    border-color: var(--border-dark);
    box-shadow: 0 4px 12px var(--shadow-dark);
}
.vod-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 12px 25px var(--shadow-light);
    border-color: var(--primary-color);
}
body.dark-mode .vod-card:hover {
    box-shadow: 0 12px 25px var(--shadow-dark);
}
.vod-poster {
    width: 100%;
    border-radius: 8px;
    aspect-ratio: 2/3;
    object-fit: cover;
    margin-bottom: 10px;
    border-bottom: 3px solid var(--primary-color);
}
.vod-title {
    margin-top: 5px;
    font-weight: 700;
    font-size: 14px;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    height: 40px;
    color: var(--text-light);
}
body.dark-mode .vod-title {
    color: var(--text-dark);
}
.vod-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 8px;
    font-size: 12px;
}
.vod-badge {
    background: var(--primary-color);
    padding: 4px 10px;
    border-radius: 10px;
    font-size: 11px;
    font-weight: bold;
    color: var(--dark-bg);
}
.vod-year {
    color: rgba(0,0,0,0.6);
    font-weight: 600;
}
body.dark-mode .vod-year {
    color: rgba(255,255,255,0.6);
}

.vod-stats {
    text-align: center;
    margin-bottom: 15px;
    font-size: 14px;
    color: var(--text-light);
    background: var(--light-card);
    padding: 10px;
    border-radius: 10px;
    border: 2px solid var(--border-light);
}
body.dark-mode .vod-stats {
    color: var(--text-dark);
    background: var(--dark-card);
    border-color: var(--border-dark);
}

.vod-loading {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 40px;
    grid-column: 1 / -1;
}
.spinner {
    width: 40px;
    height: 40px;
    border: 4px solid var(--border-light);
    border-left: 4px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
}
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

.vod-error {
    text-align: center;
    padding: 40px;
    grid-column: 1 / -1;
    color: #ff6b6b;
    font-size: 16px;
    background: var(--light-card);
    border-radius: 12px;
    border: 2px solid #ff6b6b;
}
body.dark-mode .vod-error {
    background: var(--dark-card);
}

.episode-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.95);
    justify-content: center;
    align-items: center;
    z-index: 2000;
    padding: 20px;
    backdrop-filter: blur(10px);
}
.episode-modal-content {
    background: var(--light-card);
    border-radius: 16px;
    padding: 20px;
    max-width: 800px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    border: 2px solid var(--primary-color);
    box-shadow: 0 15px 30px rgba(247, 183, 45, 0.2);
}
body.dark-mode .episode-modal-content {
    background: var(--dark-card);
}
.modal-close-btn {
    background: var(--primary-color);
    color: var(--dark-bg);
    border: none;
    padding: 10px 20px;
    border-radius: 10px;
    cursor: pointer;
    font-family: 'Almarai', sans-serif;
    font-size: 14px;
    margin-bottom: 15px;
    font-weight: 600;
    transition: all 0.3s;
}
.modal-close-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
}
.modal-title {
    margin-bottom: 15px;
    font-size: 22px;
    font-weight: 700;
    text-align: center;
    color: var(--primary-color);
}
.seasons-container {
    margin-bottom: 15px;
}
.season-btn {
    padding: 10px 20px;
    margin: 5px;
    background: var(--light-card);
    border: 2px solid var(--border-light);
    border-radius: 10px;
    color: var(--text-light);
    cursor: pointer;
    font-family: 'Almarai', sans-serif;
    font-size: 14px;
    transition: all 0.3s;
    font-weight: 600;
}
body.dark-mode .season-btn {
    background: var(--dark-card);
    color: var(--text-dark);
    border-color: var(--border-dark);
}
.season-btn:hover {
    background: var(--primary-color);
    color: var(--dark-bg);
    border-color: var(--primary-color);
}
.season-btn.active {
    background: var(--primary-color);
    color: var(--dark-bg);
    border-color: var(--primary-color);
    font-weight: 700;
}
.episode-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(65px, 1fr));
    gap: 12px;
    margin-top: 15px;
}
.ep-btn {
    padding: 12px 5px;
    background: var(--light-card);
    border: 2px solid var(--border-light);
    border-radius: 10px;
    color: var(--text-light);
    cursor: pointer;
    font-size: 14px;
    transition: all 0.3s;
    text-align: center;
    font-weight: 600;
}
body.dark-mode .ep-btn {
    background: var(--dark-card);
    color: var(--text-dark);
    border-color: var(--border-dark);
}
.ep-btn:hover {
    background: var(--primary-color);
    color: var(--dark-bg);
    border-color: var(--primary-color);
    transform: translateY(-3px);
}

/* ====== Ù†Ø§ÙØ°Ø© Ù…Ø´ØºÙ„ HLS ====== */
.hls-player-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.98);
    justify-content: center;
    align-items: center;
    z-index: 3000;
    padding: 20px;
}
.hls-player-content {
    width: 100%;
    height: 100%;
    max-width: 1200px;
    max-height: 90vh;
    position: relative;
    background: #000;
    border-radius: 12px;
    overflow: hidden;
}
#hlsVideoPlayer {
    width: 100%;
    height: 100%;
    background: #000;
}

/* Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØµÙØ±Ø§Ø¡ Ù…Ù† Ù…Ø´ØºÙ„ HLS */
.hls-control-btn {
    display: none !important;
}

.hls-time-display {
    display: none !important;
}

.hls-volume-control {
    display: none !important;
}

.hls-progress-container {
    display: none !important;
}

.hls-controls {
    display: none !important;
}

/* Ø²Ø± Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…Ø´ØºÙ„ - ÙŠØ¸Ù‡Ø± Ù„Ù…Ø¯Ø© 5 Ø«ÙˆØ§Ù† ÙÙ‚Ø· */
.close-hls-player-btn {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(247, 183, 45, 0.9);
    color: #000;
    border: none;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    z-index: 10;
    opacity: 0;
    transition: opacity 0.3s;
    pointer-events: none;
}
.close-hls-player-btn.show {
    opacity: 1;
    pointer-events: auto;
}
.close-hls-player-btn:hover {
    background: rgba(247, 183, 45, 1);
    transform: scale(1.1);
}

/* Ø¥Ø²Ø§Ù„Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬ÙˆØ¯Ø© */
.hls-quality-selector {
    display: none !important;
}

/* Ù‚Ø³Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª - ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ±ØªÙŠØ¨ Ø§Ù„Ø£Ø²Ø±Ø§Ø± */
.settings-page h2 {
    margin-bottom:20px;
    color: var(--text-light);
    border-bottom: 2px solid var(--primary-color);
    padding-bottom: 10px;
}
body.dark-mode .settings-page h2 {
    color: var(--text-dark);
}

.settings-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
}

.settings-page button, .settings-page a {
    display:flex;
    align-items: center;
    justify-content: space-between;
    margin: 0;
    padding: 15px;
    border-radius:12px; 
    background:var(--light-card); 
    text-decoration:none; 
    color:var(--text-light);
    text-align:right;
    font-family: 'Almarai', sans-serif;
    font-size:16px;
    border: 2px solid var(--border-light);
    transition: all 0.3s;
    font-weight: 600;
    width: 100%;
}
.settings-page button:hover, .settings-page a:hover {
    transform: translateY(-3px);
    border-color: var(--primary-color);
    box-shadow: 0 8px 20px var(--shadow-light);
}
body.dark-mode .settings-page button, body.dark-mode .settings-page a {
    background:var(--dark-card);
    color:var(--text-dark);
    border-color: var(--border-dark);
}
body.dark-mode .settings-page button:hover, body.dark-mode .settings-page a:hover {
    box-shadow: 0 8px 20px var(--shadow-dark);
}
.settings-page i {
    margin-left: 10px;
    color: var(--primary-color);
}

/* ØªØ¬Ù…ÙŠØ¹ Ø£Ø²Ø±Ø§Ø± Ù…Ù…Ø§Ø«Ù„Ø© */
.settings-group {
    background: var(--light-card);
    border-radius: 12px;
    padding: 15px;
    margin-bottom: 15px;
    border: 2px solid var(--border-light);
}
body.dark-mode .settings-group {
    background: var(--dark-card);
    border-color: var(--border-dark);
}
.settings-group h3 {
    margin-bottom: 12px;
    color: var(--primary-color);
    font-size: 16px;
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border-light);
}
body.dark-mode .settings-group h3 {
    border-bottom-color: var(--border-dark);
}

.modal {
    display:none; 
    position:fixed; 
    top:0; 
    left:0; 
    right:0; 
    bottom:0; 
    background:rgba(0,0,0,0.8); 
    justify-content:center; 
    align-items:center; 
    z-index:2000;
    backdrop-filter: blur(5px);
} 
.modal-content {
    background:var(--light-card); 
    padding:25px; 
    border-radius:16px; 
    width:90%; 
    max-width:400px; 
    text-align:center;
    border: 2px solid var(--primary-color);
    box-shadow: 0 15px 30px rgba(247, 183, 45, 0.2);
} 
body.dark-mode .modal-content {
    background:var(--dark-card);
} 
.close-btn {
    margin-top:15px; 
    padding:10px 20px; 
    background:var(--primary-color); 
    color:var(--dark-bg); 
    border:none; 
    border-radius:10px; 
    cursor:pointer;
    font-family: 'Almarai', sans-serif;
    font-size:14px;
    font-weight: 600;
    transition: all 0.3s;
}
.close-btn:hover {
    background: var(--primary-dark);
    transform: translateY(-2px);
}

/* ====== ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© ====== */
.favorite-btn {
    position: absolute;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.7);
    color: white;
    border: none;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 10;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
}
.favorite-btn:hover {
    background: var(--primary-color);
    transform: scale(1.1);
}
.favorite-btn.active {
    background: var(--primary-color);
    color: #000;
}

/* Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹ */
.watch-later-btn {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0,0,0,0.7);
    color: white;
    border: none;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    cursor: pointer;
    z-index: 10;
    transition: all 0.3s;
    display: flex;
    align-items: center;
    justify-content: center;
}
.watch-later-btn:hover {
    background: #2196F3;
    transform: scale(1.1);
}
.watch-later-btn.active {
    background: #2196F3;
    color: white;
}

.toast {
    position: fixed;
    top: 80px;
    right: 20px;
    background: var(--light-card);
    color: var(--text-light);
    padding: 15px 20px;
    border-radius: 10px;
    box-shadow: 0 5px 15px var(--shadow-light);
    display: flex;
    align-items: center;
    gap: 10px;
    z-index: 9999;
    transform: translateX(150%);
    transition: transform 0.3s ease;
    border-right: 4px solid var(--primary-color);
}
.toast.show {
    transform: translateX(0);
}
.toast-success { border-right-color: #4CAF50; }
.toast-error { border-right-color: #f44336; }
.toast-info { border-right-color: var(--primary-color); }
body.dark-mode .toast {
    background: var(--dark-card);
    color: var(--text-dark);
}

.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 20px;
    gap: 10px;
    grid-column: 1 / -1;
}
.pagination button {
    padding: 8px 16px;
    background: var(--light-card);
    border: 2px solid var(--border-light);
    border-radius: 8px;
    color: var(--text-light);
    cursor: pointer;
    transition: all 0.3s;
    font-family: 'Almarai', sans-serif;
}
.pagination button:hover:not(:disabled) {
    background: var(--primary-color);
    border-color: var(--primary-color);
    color: var(--dark-bg);
}
.pagination button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
.pagination span {
    color: var(--text-light);
    font-weight: 600;
}
body.dark-mode .pagination button {
    background: var(--dark-card);
    color: var(--text-dark);
    border-color: var(--border-dark);
}
body.dark-mode .pagination span {
    color: var(--text-dark);
}

.vod-card .loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    border-radius: 10px;
    opacity: 0;
    transition: opacity 0.3s;
}
.vod-card.loading .loading-overlay {
    opacity: 1;
}

.progress-bar {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: rgba(0,0,0,0.1);
    border-radius: 0 0 10px 10px;
    overflow: hidden;
}
.progress-fill {
    height: 100%;
    background: var(--primary-color);
    width: 0%;
    transition: width 0.3s;
}

/* Ù…Ù†Ø¹ Ø§Ù„Ø³Ø­Ø¨ Ù„Ù„ØªÙ†Ù‚Ù„ */
.no-swipe {
    touch-action: pan-y pinch-zoom;
    overflow-x: hidden;
}

/* Ø¥Ø¶Ø§ÙØ© ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ø¹Ù†ØµØ± Ø§Ù„ØªØ­Ù…ÙŠÙ„ */
#playerLoading .spinner {
    width: 50px;
    height: 50px;
    border: 5px solid rgba(255,255,255,0.3);
    border-left: 5px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 15px;
}

#playerLoading {
    color: white;
    font-size: 16px;
    font-family: 'Almarai', sans-serif;
    background: rgba(0,0,0,0.7);
    padding: 20px;
    border-radius: 15px;
    min-width: 200px;
}

@media (max-width: 768px) {
    .content-grid {
        grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
        gap: 12px;
    }
    .vod-card {
        padding: 10px;
    }
    .vod-title {
        font-size: 13px;
        height: 36px;
    }
    .episode-list {
        grid-template-columns: repeat(auto-fill, minmax(55px, 1fr));
    }
    .channel-card {
        width: 170px;
    }
    .hls-player-content {
        max-height: 60vh;
    }
}

@media (max-width: 480px) {
    .content-grid {
        grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
        gap: 10px;
    }
    .vod-card {
        padding: 8px;
    }
    .vod-title {
        font-size: 12px;
        height: 34px;
    }
    .channel-card {
        width: 150px;
    }
    .top-bar h1 {
        font-size: 20px;
    }
}
</style> 
</head> 
<body> 
<div class="top-bar"><h1>LeoTV</h1></div> 

<div id="home-page" class="page"> 
    <div class="slider-container" id="slider"></div> 
    <div class="slider-dots" id="dots"></div> 

    <div class="channel-section"> 
        <h2>Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©</h2> 
        <div class="channels" id="sports-channels"></div> 
    </div> 
    <div class="channel-section"> 
        <h2>Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„ØªØ±ÙÙŠÙ‡ÙŠØ©</h2> 
        <div class="channels" id="entertainment-channels"></div> 
    </div> 
    <div class="channel-section"> 
        <h2>Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¥Ø®Ø¨Ø§Ø±ÙŠØ©</h2> 
        <div class="channels" id="news-channels"></div> 
    </div> 
    <div class="channel-section"> 
        <h2>Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø£ÙÙ„Ø§Ù…</h2> 
        <div class="channels" id="movie-channels"></div> 
    </div> 
    <div class="channel-section"> 
        <h2>Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø¯ÙŠÙ†ÙŠØ©</h2> 
        <div class="channels" id="religious-channels"></div> 
    </div> 
    <div class="channel-section"> 
        <h2>Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø£Ø·ÙØ§Ù„</h2> 
        <div class="channels" id="kids-channels"></div> 
    </div> 
</div> 

<div id="vod-page" class="page vod-page">
    <div class="search-box">
        <div class="search-icon">
            <i class="fas fa-search"></i>
        </div>
        <input type="text" class="search-input" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† ÙÙŠÙ„Ù… Ø£Ùˆ Ù…Ø³Ù„Ø³Ù„..." id="vodSearchInput">
    </div>
    
    <div class="tabs-container">
        <div class="tabs">
            <button class="vod-tab-btn active" id="moviesTab" onclick="switchVodTab('movies')">ğŸ¬ Ø§Ù„Ø£ÙÙ„Ø§Ù…</button>
            <button class="vod-tab-btn" id="seriesTab" onclick="switchVodTab('series')">ğŸ“º Ø§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª</button>
            <button class="vod-tab-btn" id="favoritesTab" onclick="switchVodTab('favorites')">â­ Ø§Ù„Ù…ÙØ¶Ù„Ø©</button>
            <button class="vod-tab-btn" id="watchLaterTab" onclick="switchVodTab('watchlater')">â° Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹</button>
        </div>
    </div>
    
    <div id="vodStats" class="vod-stats">ğŸ“Š Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    
    <div class="categories-container">
        <div id="vodCategories" class="categories"></div>
    </div>
    
    <div class="content-grid" id="vodContent">
        <div class="vod-loading">
            <div class="spinner"></div>
        </div>
    </div>
    
    <div class="pagination" id="pagination" style="display: none;">
        <button id="prevPage" onclick="changePage(-1)">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
        <span id="pageInfo">ØµÙØ­Ø© 1 Ù…Ù† 1</span>
        <button id="nextPage" onclick="changePage(1)">Ø§Ù„ØªØ§Ù„ÙŠ</button>
    </div>
</div>

<div id="settings-page" class="page settings-page"> 
    <h2>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h2> 
    
    <div class="settings-grid">
        <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø¸Ù‡Ø± -->
        <div class="settings-group">
            <h3>Ø§Ù„Ù…Ø¸Ù‡Ø±</h3>
            <button id="toggle-mode">
                <span><i class="fa-solid fa-moon"></i> ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ÙˆØ¶Ø¹ (Ù…Ø¸Ù„Ù… / ÙØ§ØªØ­)</span>
            </button>
        </div>
        
        <!-- Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ø¯Ø¹Ù… -->
        <div class="settings-group">
            <h3>Ø§Ù„ØªÙˆØ§ØµÙ„ ÙˆØ§Ù„Ø¯Ø¹Ù…</h3>
            <a href="https://t.me/Leokorraa" target="_blank">
                <span><i class="fa-brands fa-telegram"></i> ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</span>
            </a>
            <a href="#" id="privacy-btn">
                <span><i class="fa-solid fa-shield"></i> Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</span>
            </a>
            <a href="#" id="about-btn">
                <span><i class="fa-solid fa-circle-info"></i> Ø­ÙˆÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</span>
            </a>
        </div>
        
        <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª -->
        <div class="settings-group">
            <h3>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
            <button onclick="clearCache()">
                <span><i class="fas fa-trash"></i> Ù…Ø³Ø­ ÙƒØ§Ø´ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</span>
            </button>
            <button onclick="clearImageCache()">
                <span><i class="fas fa-image"></i> Ù…Ø³Ø­ ÙƒØ§Ø´ Ø§Ù„ØµÙˆØ±</span>
            </button>
        </div>
        
        <!-- Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø´Ø®ØµÙŠØ© -->
        <div class="settings-group">
            <h3>Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
            <button onclick="clearFavorites()">
                <span><i class="fas fa-heart-broken"></i> Ù…Ø³Ø­ Ø§Ù„Ù…ÙØ¶Ù„Ø©</span>
            </button>
            <button onclick="clearWatchLater()">
                <span><i class="fas fa-clock"></i> Ù…Ø³Ø­ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹</span>
            </button>
        </div>
    </div>
</div> 

<div id="privacy-modal" class="modal"> 
    <div class="modal-content"> 
        <h3>Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©</h3> 
        <p>ØªØ·Ø¨ÙŠÙ‚ Leo TV Ù…Ù„ØªØ²Ù… Ø¨Ø­Ù…Ø§ÙŠØ© Ø®ØµÙˆØµÙŠØ© Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ‡ ÙˆØªÙˆÙÙŠØ± ØªØ¬Ø±Ø¨Ø© Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¢Ù…Ù†Ø© ÙˆÙ…ÙˆØ«ÙˆÙ‚Ø©. ØªÙ‡Ø¯Ù Ù‡Ø°Ù‡ Ø§Ù„Ø³ÙŠØ§Ø³Ø© Ø¥Ù„Ù‰ ØªÙˆØ¶ÙŠØ­ ÙƒÙŠÙÙŠØ© Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø·Ø±ÙŠÙ‚Ø© Ø´ÙØ§ÙØ© ÙˆÙ…Ù‡Ù†ÙŠØ©.</p> 
        <button class="close-btn">Ø¥ØºÙ„Ø§Ù‚</button> 
    </div> 
</div> 
<div id="about-modal" class="modal"> 
    <div class="modal-content"> 
        <h3>Ø­ÙˆÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚</h3> 
        <p>LeoTV v3.0<br>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: Ø¯ÙŠØ³Ù…Ø¨Ø± 2024<br>Ø¨Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ù‚Ø³Ù… Ø§Ù„Ø£ÙÙ„Ø§Ù… ÙˆØ§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª Ø§Ù„Ù…ØªÙƒØ§Ù…Ù„<br>Ù…Ø¹ Ù…ÙŠØ²Ø§Øª Ø§Ù„Ù…ÙØ¶Ù„Ø© ÙˆØ§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø¤Ù‚Øª</p> 
        <button class="close-btn">Ø¥ØºÙ„Ø§Ù‚</button> 
    </div> 
</div>

<div class="episode-modal" id="episodeModal">
    <div class="episode-modal-content">
        <button class="modal-close-btn" onclick="closeEpisodeModal()">âœ• Ø¥ØºÙ„Ø§Ù‚</button>
        <h3 class="modal-title" id="modalTitle">ğŸ¬ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</h3>
        <div class="seasons-container" id="seasons"></div>
        <div id="episodes" class="episode-list"></div>
    </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ù…Ø´ØºÙ„ HLS -->
<div class="hls-player-modal" id="hlsPlayerModal">
    <div class="hls-player-content">
        <!-- Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ ÙÙ‚Ø· -->
        <button class="close-hls-player-btn" id="hlsCloseBtn" onclick="closeHlsPlayer()">âœ•</button>
        <!-- ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬ÙˆØ¯Ø© -->
        <video id="hlsVideoPlayer" controls playsinline></video>
    </div>
</div>

<div class="bottom-bar"> 
    <button class="tab-btn active" data-target="home-page"><i class="fa-solid fa-tv"></i><span>TV</span></button> 
    <button class="tab-btn" data-target="vod-page"><i class="fa-solid fa-clapperboard"></i><span>VOD</span></button> 
    <button class="tab-btn" data-target="settings-page"><i class="fa-solid fa-gear"></i><span>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</span></button> 
</div> 

<script>
// ==================== Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ====================
let VOD_DATA = { movieCats: [], seriesCats: [], movies: [], series: [] };
let currentVodTab = 'movies', currentVodCat = 'all', vodSearchText = '';
let currentPage = 1, itemsPerPage = 20;
let searchTimeout;
let startX = 0;
let hls = null;
let imageCache = {};
let watchLater = [];
let closeButtonTimer = null;

// ==================== Ø¥Ø¯Ø§Ø±Ø© Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ ÙÙŠ Ù…Ø´ØºÙ„ HLS ====================
function showCloseButton() {
    const closeBtn = document.getElementById('hlsCloseBtn');
    if (closeBtn) {
        // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ø²Ø±
        closeBtn.classList.add('show');
        
        // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø²Ø± Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
        if (closeButtonTimer) clearTimeout(closeButtonTimer);
        closeButtonTimer = setTimeout(() => {
            closeBtn.classList.remove('show');
        }, 5000);
    }
}

function resetCloseButtonTimer() {
    const closeBtn = document.getElementById('hlsCloseBtn');
    if (closeBtn && closeBtn.classList.contains('show')) {
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…Ø¤Ù‚Øª Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø²Ø± Ø¸Ø§Ù‡Ø±Ø§Ù‹
        if (closeButtonTimer) clearTimeout(closeButtonTimer);
        closeButtonTimer = setTimeout(() => {
            closeBtn.classList.remove('show');
        }, 5000);
    }
}

// ==================== Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹ ====================
function loadWatchLater() {
    try {
        const saved = localStorage.getItem('watchLater');
        if (saved) {
            watchLater = JSON.parse(saved);
        }
    } catch(e) {
        console.error('Error loading watch later:', e);
        watchLater = [];
    }
}

function saveWatchLater() {
    try {
        localStorage.setItem('watchLater', JSON.stringify(watchLater));
    } catch(e) {
        console.error('Error saving watch later:', e);
    }
}

function toggleWatchLater(event, encoded, type) {
    event.stopPropagation();
    
    try {
        const item = JSON.parse(decodeURIComponent(encoded));
        const watchId = `${type}_${item.stream_id || item.series_id || item.id}`;
        const index = watchLater.findIndex(w => w.id === watchId);
        
        if (index > -1) {
            watchLater.splice(index, 1);
            showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹', 'info');
        } else {
            watchLater.push({
                id: watchId,
                type: type,
                data: item,
                added: Date.now()
            });
            showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹', 'success');
        }
        
        saveWatchLater();
        
        // ØªØ­Ø¯ÙŠØ« Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹
        const btn = event.target.closest('.watch-later-btn');
        if (btn) {
            btn.classList.toggle('active');
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¥Ø°Ø§ ÙƒÙ†Ø§ ÙÙŠ ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹
        if (currentVodTab === 'watchlater') {
            showVodContent();
        }
    } catch(e) {
        console.error('Error toggling watch later:', e);
    }
}

function isInWatchLater(item, type) {
    const watchId = `${type}_${item.stream_id || item.series_id || item.id}`;
    return watchLater.some(w => w.id === watchId);
}

function clearWatchLater() {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹ØŸ')) {
        watchLater = [];
        saveWatchLater();
        showToast('ØªÙ… Ù…Ø³Ø­ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹', 'info');
        if (currentVodTab === 'watchlater') showVodContent();
    }
}

// ==================== Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª ====================
let viewsData = {};

function loadViews() {
    try {
        const saved = localStorage.getItem('movieViews');
        if (saved) {
            viewsData = JSON.parse(saved);
        }
    } catch(e) {
        console.error('Error loading views:', e);
        viewsData = {};
    }
}

function saveViews() {
    try {
        localStorage.setItem('movieViews', JSON.stringify(viewsData));
    } catch(e) {
        console.error('Error saving views:', e);
    }
}

function incrementViews(itemId, type) {
    const key = `${type}_${itemId}`;
    if (!viewsData[key]) {
        viewsData[key] = 0;
    }
    viewsData[key]++;
    saveViews();
}

function getViewsCount(itemId, type) {
    const key = `${type}_${itemId}`;
    return viewsData[key] || 0;
}

// ==================== ØªØ®Ø²ÙŠÙ† Ø§Ù„ØµÙˆØ± ====================
class ImageCacheManager {
    constructor() {
        this.cacheName = 'leotv-images-cache';
        this.cacheDuration = 7 * 24 * 60 * 60 * 1000;
        this.init();
    }

    async init() {
        try {
            const cached = localStorage.getItem('imageCacheData');
            if (cached) {
                imageCache = JSON.parse(cached);
                this.cleanExpired();
            }
        } catch(e) {
            console.log('Image cache init error:', e);
            imageCache = {};
        }
    }

    async cacheImage(url, element) {
        try {
            if (imageCache[url] && Date.now() - imageCache[url].timestamp < this.cacheDuration) {
                element.src = imageCache[url].data;
                return true;
            }

            const response = await fetch(url, { mode: 'cors' });
            const blob = await response.blob();
            const reader = new FileReader();
            
            reader.onloadend = () => {
                imageCache[url] = {
                    data: reader.result,
                    timestamp: Date.now()
                };
                element.src = reader.result;
                this.saveCache();
            };
            
            reader.readAsDataURL(blob);
            return true;
            
        } catch(e) {
            console.error('Error caching image:', e);
            // Ø§Ø³ØªØ®Ø¯Ù… ØµÙˆØ±Ø© Ø§ÙØªØ±Ø§Ø¶ÙŠØ©
            element.src = 'https://via.placeholder.com/400x300/333/fff?text=Ù‚Ù†Ø§Ø©';
            return false;
        }
    }

    saveCache() {
        try {
            localStorage.setItem('imageCacheData', JSON.stringify(imageCache));
        } catch(e) {
            console.error('Error saving image cache:', e);
        }
    }

    cleanExpired() {
        const now = Date.now();
        let cleaned = false;
        
        for (const url in imageCache) {
            if (now - imageCache[url].timestamp > this.cacheDuration) {
                delete imageCache[url];
                cleaned = true;
            }
        }
        
        if (cleaned) this.saveCache();
    }

    clearCache() {
        imageCache = {};
        localStorage.removeItem('imageCacheData');
    }
}

const imageCacheManager = new ImageCacheManager();

// ==================== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ====================
async function initHomePage() {
    const sliderContainer = document.getElementById('slider');
    const dotsContainer = document.getElementById('dots');
    
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø±
    const sliderImages = [
        { src: 'https://a.top4top.io/p_3603kbcqz1.png' },
        { src: 'https://b.top4top.io/p_36033q7x61.jpeg' },
        { src: 'https://c.top4top.io/p_3603272bw1.png' },
        { src: 'https://d.top4top.io/p_3603a90sm1.jpeg' }
    ];
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø±
    let sliderHTML = '';
    sliderImages.forEach((img, index) => {
        sliderHTML += `
            <div class="slide">
                <img src="${img.src}" loading="lazy" alt="Ø³Ù„Ø§ÙŠØ¯Ø± ${index + 1}">
            </div>
        `;
    });
    sliderContainer.innerHTML = sliderHTML;
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù†Ù‚Ø§Ø·
    dotsContainer.innerHTML = '';
    sliderImages.forEach((_, i) => {
        const dot = document.createElement("span");
        dot.classList.add("dot");
        if(i === 0) dot.classList.add("active");
        dot.addEventListener("click", () => {
            sliderContainer.scrollTo({ left: i * sliderContainer.offsetWidth, behavior: "smooth" });
            updateDots(i);
        });
        dotsContainer.appendChild(dot);
    });
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø· Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªÙ…Ø±ÙŠØ±
    sliderContainer.addEventListener("scroll", () => {
        const i = Math.round(sliderContainer.scrollLeft / sliderContainer.offsetWidth);
        updateDots(i);
    });
    
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ù…Ø¹ Ø§Ù„ØµÙˆØ± Ø§Ù„ØªÙŠ Ø£Ø±Ø³Ù„ØªÙ‡Ø§
    const channelsData = {
        'sports-channels': [
            { src: 'https://e.top4top.io/p_3515ce5bg1.jpg', title: 'beIN Sports 1', link: 'go:b1' },
            { src: 'https://f.top4top.io/p_3515ulv1u1.jpg', title: 'beIN Sports 2', link: 'go:b2' },
            { src: 'https://g.top4top.io/p_3515ietds1.jpg', title: 'beIN Sports 3', link: 'go:b3' },
            { src: 'https://i.top4top.io/p_35155yym91.jpg', title: 'beIN Sports 4', link: 'go:b4' },
            { src: 'https://k.top4top.io/p_3515gyfa01.jpg', title: 'beIN Sports 5', link: 'go:b5' },
            { src: 'https://j.top4top.io/p_3515qki961.jpg', title: 'beIN Sports 6', link: 'go:b6' },
            { src: 'https://l.top4top.io/p_3515uzp3p1.jpg', title: 'beIN Sports 7', link: 'go:b7' },
            { src: 'https://a.top4top.io/p_3515niq6i1.jpg', title: 'beIN Sports 1 Extra', link: 'go:b8' },
            { src: 'https://a.top4top.io/p_3515niq6i1.jpg', title: 'beIN Sports 2 Extra', link: 'go:b9' },
            { src: 'https://b.top4top.io/p_3589cg6w01.jpg', title: 'THMANYAH 1', link: 'go:s4' },
            { src: 'https://b.top4top.io/p_3589cg6w01.jpg', title: 'THMANYAH 2', link: 'go:s5' },
            { src: 'https://h.top4top.io/p_3515je0pz1.jpg', title: 'AD Sports 1', link: 'go:a1' },
            { src: 'https://i.top4top.io/p_3515f9ary1.jpg', title: 'AD Sports 2', link: 'go:a2' },
            { src: 'https://j.top4top.io/p_3515zj9ur1.jpg', title: 'Iraq Sport', link: 'go:iraq' }
        ],
        'entertainment-channels': [
            { src: 'https://k.top4top.io/p_35151yt8d1.jpg', title: 'Iraqi TV', link: 'go:ent1' },
            { src: 'https://l.top4top.io/p_35157d3101.jpg', title: 'Al Sumaria', link: 'go:ent2' },
            { src: 'https://a.top4top.io/p_3515qvx9q1.jpg', title: 'Abu Dhani International', link: 'go:ent3' },
            { src: 'https://b.top4top.io/p_35155g1g21.jpg', title: 'Al Ahad', link: 'go:ent4' },
            { src: 'https://c.top4top.io/p_3515r8ogk1.jpg', title: 'Dijlah', link: 'go:ent5' }
        ],
        'news-channels': [
            { src: 'https://a.top4top.io/p_3515w0xg31.jpg', title: 'Iraqi News', link: 'go:news1' },
            { src: 'https://d.top4top.io/p_35157f0fi1.jpg', title: 'Al Sharqiya News', link: 'go:news2' },
            { src: 'https://b.top4top.io/p_3515d7lwx1.jpg', title: 'Al Hadath', link: 'go:news3' },
            { src: 'https://e.top4top.io/p_3515tqq9q1.jpg', title: 'Al Jazeera', link: 'go:news4' },
            { src: 'https://c.top4top.io/p_3515uz16d1.jpg', title: 'Al Arabiya', link: 'go:news5' }
        ],
        'movie-channels': [
            { src: 'https://d.top4top.io/p_35150ozaa1.jpg', title: 'beIN Movies Premiere 1', link: 'go:e1' },
            { src: 'https://e.top4top.io/p_3515no4iq1.jpg', title: 'beIN Movies Action 2', link: 'go:e2' },
            { src: 'https://g.top4top.io/p_351596u5t1.jpg', title: 'beIN Movies Family 3', link: 'go:e3' },
            { src: 'https://f.top4top.io/p_35153tx361.jpg', title: 'beIN Movies Drama 4', link: 'go:e4' }
        ],
        'religious-channels': [
            { src: 'https://c.top4top.io/p_35151as1k1.jpg', title: 'Karbala TV', link: 'go:n16' },
            { src: 'https://e.top4top.io/p_35151stjr1.jpg', title: 'Al Shaair TV', link: 'go:n17' },
            { src: 'https://f.top4top.io/p_35151kpz21.jpg', title: 'Al Anwar TV', link: 'go:n15' },
            { src: 'https://h.top4top.io/p_35993ayw81.jpg', title: 'Makkah TV', link: 'go:n5' },
            { src: 'https://d.top4top.io/p_35150b8vt1.jpg', title: 'Imam Hussain 2 TV', link: 'go:n6' }
        ],
        'kids-channels': [
            { src: 'https://c.top4top.io/p_3515xn1h21.jpg', title: 'Spacetoon', link: 'go:f5' },
            { src: 'https://g.top4top.io/p_3515v3g191.jpg', title: 'Cartoon Network', link: 'go:e5' },
            { src: 'https://e.top4top.io/p_35154x7171.jpg', title: 'Taha TV', link: 'go:f6' },
            { src: 'https://d.top4top.io/p_3515ltgq61.jpg', title: 'Majid TV', link: 'go:f4' },
            { src: 'https://f.top4top.io/p_35151gasj1.jpg', title: 'Jeem TV', link: 'go:f3' }
        ]
    };
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù‚Ù†ÙˆØ§Øª
    for (const [containerId, channels] of Object.entries(channelsData)) {
        const container = document.getElementById(containerId);
        let channelsHTML = '';
        
        channels.forEach(channel => {
            channelsHTML += `
                <a href="${channel.link}" class="channel-card">
                    <img src="${channel.src}" loading="lazy" 
                         alt="${channel.title}"
                         onerror="this.src='https://via.placeholder.com/400x300/333/fff?text=${encodeURIComponent(channel.title)}'">
                    <p>${channel.title}</p>
                </a>
            `;
        });
        
        container.innerHTML = channelsHTML;
    }
}

function updateDots(index) {
    const allDots = document.querySelectorAll(".dot");
    allDots.forEach(d => d.classList.remove("active"));
    if (allDots[index]) allDots[index].classList.add("active");
}

// ==================== Ù…Ø¹Ø§Ù„Ø¬Ø© Ø±ÙˆØ§Ø¨Ø· go (Ø§Ù„Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©) ====================
// Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ØªØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø±ÙˆØ§Ø¨Ø· go:xxx
// Ø¹Ù†Ø¯Ù…Ø§ ÙŠØ¶ØºØ· Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ Ù‚Ù†Ø§Ø©ØŒ Ø³ÙŠÙ†ØªÙ‚Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù…Ø´ØºÙ„ Ù…Ø¹ Ù…Ø¹Ø±Ù Ø§Ù„Ù‚Ù†Ø§Ø©
// ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø³ØªØ®Ø¯Ø§Ù… JavaScript Ù„ØªÙˆØ¬ÙŠÙ‡Ù‡ Ø£Ùˆ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©

// Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ù„Ø±ÙˆØ§Ø¨Ø· go:xxx Ø³ØªÙØªØ­ ÙÙŠ Ù†ÙØ³ Ø§Ù„ØµÙØ­Ø©
// Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª ÙØªØ­Ù‡Ø§ ÙÙŠ Ù†Ø§ÙØ°Ø© Ù…Ù†ÙØµÙ„Ø©ØŒ Ø§Ø³ØªØ®Ø¯Ù… target="_blank" ÙÙŠ Ø§Ù„ÙˆØ³Ù… <a>

// ==================== Ù…Ø´ØºÙ„ HLS.js ====================
function openHlsPlayer(url, title) {
    console.log('Opening HLS video:', title, 'URL:', url);
    
    const modal = document.getElementById('hlsPlayerModal');
    const video = document.getElementById('hlsVideoPlayer');
    
    // Ø¥ØºÙ„Ø§Ù‚ Ø£ÙŠ Ù…Ø´ØºÙ„ Ø³Ø§Ø¨Ù‚
    if (hls) {
        hls.destroy();
        hls = null;
    }
    
    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
    video.pause();
    video.currentTime = 0;
    video.volume = 1;
    video.src = '';
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¯Ø¹Ù… HLS
    if (Hls.isSupported()) {
        hls = new Hls({
            enableWorker: true,
            lowLatencyMode: true,
            backBufferLength: 90,
            manifestLoadingTimeOut: 10000,
            manifestLoadingMaxRetry: 3,
            levelLoadingTimeOut: 10000,
            levelLoadingMaxRetry: 3,
            fragLoadingTimeOut: 10000,
            fragLoadingMaxRetry: 3,
            startLevel: -1,
            capLevelToPlayerSize: true
        });
        
        hls.loadSource(url);
        hls.attachMedia(video);
        
        hls.on(Hls.Events.MANIFEST_PARSED, function() {
            console.log('HLS manifest loaded');
            video.play().catch(e => {
                console.error('Auto-play failed:', e);
                showToast('Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ù„Ù„Ø¨Ø¯Ø¡', 'info');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ù„Ù…Ø¯Ø© 5 Ø«ÙˆØ§Ù†
            showCloseButton();
        });
        
        hls.on(Hls.Events.ERROR, function(event, data) {
            console.error('HLS error:', data);
            
            if (data.fatal) {
                switch(data.type) {
                    case Hls.ErrorTypes.NETWORK_ERROR:
                        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©. Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©...', 'error');
                        hls.startLoad();
                        break;
                    case Hls.ErrorTypes.MEDIA_ERROR:
                        showToast('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ÙˆØ³Ø§Ø¦Ø·. Ø¬Ø§Ø±ÙŠ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ±...', 'error');
                        hls.recoverMediaError();
                        break;
                    default:
                        showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ', 'error');
                        closeHlsPlayer();
                        break;
                }
            }
        });
        
    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = url;
        video.addEventListener('loadedmetadata', function() {
            video.play().catch(e => {
                console.error('Auto-play failed:', e);
                showToast('Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ù„Ù„Ø¨Ø¯Ø¡', 'info');
            });
            
            // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚ Ù„Ù…Ø¯Ø© 5 Ø«ÙˆØ§Ù†
            showCloseButton();
        });
    } else {
        showToast('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ´ØºÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ', 'error');
        return;
    }
    
    modal.style.display = 'flex';
    
    // Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø· Ø§Ù„Ù…Ø¤Ù‚Øª Ø¹Ù†Ø¯ Ø§Ù„ØªÙØ§Ø¹Ù„ Ù…Ø¹ Ø§Ù„ÙÙŠØ¯ÙŠÙˆ
    video.addEventListener('click', resetCloseButtonTimer);
    modal.addEventListener('mousemove', resetCloseButtonTimer);
}

function closeHlsPlayer() {
    const modal = document.getElementById('hlsPlayerModal');
    const video = document.getElementById('hlsVideoPlayer');
    
    // Ø¥Ø²Ø§Ù„Ø© Ø¹Ù†ØµØ± Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ø§Ù‹
    const loadingDiv = document.getElementById('playerLoading');
    if (loadingDiv) {
        loadingDiv.remove();
    }
    
    // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ù…Ø³ØªÙ…Ø¹ÙŠÙ† Ù„Ù„Ø£Ø­Ø¯Ø§Ø«
    video.removeEventListener('click', resetCloseButtonTimer);
    modal.removeEventListener('mousemove', resetCloseButtonTimer);
    
    // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø¤Ù‚Øª
    if (closeButtonTimer) {
        clearTimeout(closeButtonTimer);
        closeButtonTimer = null;
    }
    
    // Ø¥Ø®ÙØ§Ø¡ Ø²Ø± Ø§Ù„Ø¥ØºÙ„Ø§Ù‚
    const closeBtn = document.getElementById('hlsCloseBtn');
    if (closeBtn) {
        closeBtn.classList.remove('show');
    }
    
    if (video) {
        video.pause();
        video.src = '';
    }
    
    if (hls) {
        hls.destroy();
        hls = null;
    }
    
    modal.style.display = 'none';
}

// ==================== ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø§ØµØ± ØªØ­ÙƒÙ… Ù…Ø´ØºÙ„ HLS ====================
function initHlsControls() {
    // ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØµÙØ±Ø§Ø¡ØŒ Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ù„ØªÙ‡ÙŠØ¦Ø©
}

function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
}

// ==================== Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ­ÙƒÙ… Ù„Ù„Ù…Ø´ØºÙ„ ====================
document.addEventListener('keydown', function(e) {
    const video = document.getElementById('hlsVideoPlayer');
    const modal = document.getElementById('hlsPlayerModal');
    
    if (!video || modal.style.display !== 'flex') return;
    
    switch(e.key) {
        case ' ':
            e.preventDefault();
            if (video.paused) video.play();
            else video.pause();
            break;
        case 'Escape':
            closeHlsPlayer();
            break;
        case 'f':
            const container = document.querySelector('.hls-player-content');
            if (!document.fullscreenElement) {
                container.requestFullscreen().catch(e => {
                    console.error('Fullscreen error:', e);
                });
            } else {
                document.exitFullscreen();
            }
            break;
    }
});

// ==================== Ø¥ØºÙ„Ø§Ù‚ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø´ØºÙ„ ====================
document.getElementById('hlsPlayerModal').addEventListener('click', function(e) {
    if (e.target.id === 'hlsPlayerModal') {
        closeHlsPlayer();
    }
});

// ==================== Ø§Ù„ÙƒØ§Ø´ ====================
const cache = {
    data: null,
    timestamp: 0,
    duration: 30 * 60 * 1000,
    load: function() {
        try {
            const cached = localStorage.getItem('vodCache');
            if (cached) {
                const parsed = JSON.parse(cached);
                if (Date.now() - parsed.timestamp < this.duration) {
                    this.data = parsed.data;
                    this.timestamp = parsed.timestamp;
                    return true;
                }
            }
        } catch(e) { console.log('Cache load error:', e); }
        return false;
    },
    save: function() {
        try {
            localStorage.setItem('vodCache', JSON.stringify({
                data: VOD_DATA,
                timestamp: Date.now()
            }));
        } catch(e) { console.log('Cache save error:', e); }
    }
};

// ==================== Ø§Ù„Ù…ÙØ¶Ù„Ø© ====================
let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');

function toggleFavorite(event, encoded, type) {
    event.stopPropagation();
    
    try {
        const item = JSON.parse(decodeURIComponent(encoded));
        const favId = `${type}_${item.stream_id || item.series_id || item.id}`;
        const index = favorites.findIndex(f => f.id === favId);
        
        if (index > -1) {
            favorites.splice(index, 1);
            showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø²Ø§Ù„Ø© Ù…Ù† Ø§Ù„Ù…ÙØ¶Ù„Ø©', 'info');
        } else {
            favorites.push({
                id: favId,
                type: type,
                data: item,
                added: Date.now()
            });
            showToast('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙØ¶Ù„Ø©', 'success');
        }
        
        localStorage.setItem('favorites', JSON.stringify(favorites));
        
        const btn = event.target.closest('.favorite-btn');
        if (btn) {
            btn.classList.toggle('active');
        }
        
        if (currentVodTab === 'favorites') {
            showVodContent();
        }
    } catch(e) {
        console.error('Error toggling favorite:', e);
    }
}

function isFavorite(item, type) {
    const favId = `${type}_${item.stream_id || item.series_id || item.id}`;
    return favorites.some(f => f.id === favId);
}

function clearFavorites() {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ù…ÙØ¶Ù„Ø©ØŸ')) {
        favorites = [];
        localStorage.removeItem('favorites');
        showToast('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ù…ÙØ¶Ù„Ø©', 'info');
        if (currentVodTab === 'favorites') showVodContent();
    }
}

// ==================== Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª ====================
function showToast(message, type = 'info') {
    const toast = document.createElement('div');
    toast.className = `toast toast-${type}`;
    toast.innerHTML = `
        <i class="fas fa-${type === 'success' ? 'check-circle' : 
                         type === 'error' ? 'exclamation-circle' : 
                         'info-circle'}"></i>
        <span>${message}</span>
    `;
    
    document.body.appendChild(toast);
    
    setTimeout(() => toast.classList.add('show'), 100);
    setTimeout(() => {
        toast.classList.remove('show');
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}

// ==================== Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØµÙØ­Ø§Øª ====================
const tabs = document.querySelectorAll(".tab-btn");
const pages = document.querySelectorAll(".page");
tabs.forEach(tab => tab.addEventListener("click", () => {
    tabs.forEach(t => t.classList.remove("active"));
    tab.classList.add("active");
    pages.forEach(p => p.style.display = "none");
    document.getElementById(tab.dataset.target).style.display = "block";
    
    if(tab.dataset.target === 'vod-page' && VOD_DATA.movies.length === 0) {
        loadAllVod();
    }
}));

// ==================== Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨Ø§Ù„Ø³Ø­Ø¨ ====================
function disableSwipeNavigation() {
    document.body.classList.add('no-swipe');
    document.removeEventListener('touchstart', handleTouchStart);
    document.removeEventListener('touchend', handleTouchEnd);
}

function handleTouchStart(e) {
    startX = e.touches[0].clientX;
}

function handleTouchEnd(e) {
    // ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ¸ÙŠÙØ© Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨Ø§Ù„Ø³Ø­Ø¨
    startX = 0;
}

// ==================== Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø¸Ù„Ù… ====================
document.getElementById("toggle-mode").addEventListener("click", () => {
    document.body.classList.toggle("dark-mode");
    localStorage.setItem("darkMode", document.body.classList.contains("dark-mode"));
    const icon = document.querySelector("#toggle-mode i");
    icon.classList.toggle("fa-moon");
    icon.classList.toggle("fa-sun");
});
if(localStorage.getItem("darkMode") === "true") {
    document.body.classList.add("dark-mode");
    const icon = document.querySelector("#toggle-mode i");
    if(icon) {
        icon.classList.remove("fa-moon");
        icon.classList.add("fa-sun");
    }
}

// ==================== Ø§Ù„Ù†ÙˆØ§ÙØ° Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© ====================
const aboutBtn = document.getElementById("about-btn");
const aboutModal = document.getElementById("about-modal");
const privacyBtn = document.getElementById("privacy-btn");
const privacyModal = document.getElementById("privacy-modal");
const closeBtns = document.querySelectorAll(".close-btn");
aboutBtn.addEventListener("click", e => { e.preventDefault(); aboutModal.style.display = "flex"; });
privacyBtn.addEventListener("click", e => { e.preventDefault(); privacyModal.style.display = "flex"; });
closeBtns.forEach(btn => btn.addEventListener("click", () => { aboutModal.style.display = "none"; privacyModal.style.display = "none"; }));
aboutModal.addEventListener("click", e => { if(e.target === aboutModal) aboutModal.style.display = "none"; });
privacyModal.addEventListener("click", e => { if(e.target === privacyModal) privacyModal.style.display = "none"; });

// ==================== VOD FUNCTIONS ====================
const SERVERS = [
    { url: 'http://darkteam.vip:80/', user: '95417881928554', pass: '22902843444965' },
];
const activeServers = SERVERS.filter(s => s.url && s.user && s.pass);

async function api(server, action) {
    try {
        const apiUrl = `${server.url}/player_api.php?username=${server.user}&password=${server.pass}&action=${action}`;
        const r = await fetch(apiUrl);
        if (!r.ok) throw new Error(`Ø®Ø·Ø£ HTTP: ${r.status}`);
        return await r.json();
    } catch(e) { 
        console.error('API Error:', e);
        return []; 
    }
}

async function getSeriesInfo(server, seriesId) {
    try {
        const r = await fetch(`${server.url}/player_api.php?username=${server.user}&password=${server.pass}&action=get_series_info&series_id=${seriesId}`);
        return await r.json();
    } catch(e) { 
        console.error('Series info error:', e);
        return null; 
    }
}

function filterAdult(arr) {
    const bad = ['adult','xxx','porn','18+','sex','Ø¬Ù†Ø³','Ø§Ø¨Ø§Ø­ÙŠ','Ø¥Ø¨Ø§Ø­ÙŠ','Ø³ÙƒØ³'];
    return (arr||[]).filter(i => {
        const t = ((i.name||'')+(i.title||'')+(i.category_name||'')).toLowerCase();
        return !bad.some(b => t.includes(b));
    });
}

// ØªØ­Ù…ÙŠÙ„ ÙƒÙ„ Ø¨ÙŠØ§Ù†Ø§Øª VOD
async function loadAllVod() {
    if (cache.load()) {
        VOD_DATA = cache.data;
        updateUI();
        showToast('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„ÙƒØ§Ø´', 'info');
        return;
    }
    
    document.getElementById('vodContent').innerHTML = '<div class="vod-loading"><div class="spinner"></div></div>';
    document.getElementById('vodStats').textContent = 'ğŸ“Š Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...';
    
    let movieCats = [], seriesCats = [], movies = [], series = [];
    let hasError = false;
    
    for(let s of activeServers) {
        try {
            console.log('Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù† Ø³ÙŠØ±ÙØ±:', s.url);
            
            const mc = await api(s, 'get_vod_categories');
            filterAdult(mc).forEach(c => { 
                if(!movieCats.find(x => x.category_name === c.category_name)) 
                    movieCats.push({ ...c, server: s }); 
            });
            
            const sc = await api(s, 'get_series_categories');
            filterAdult(sc).forEach(c => { 
                if(!seriesCats.find(x => x.category_name === c.category_name)) 
                    seriesCats.push({ ...c, server: s }); 
            });
            
            const mv = await api(s, 'get_vod_streams');
            const filteredMovies = filterAdult(mv).map(m => ({ 
                ...m, 
                server: s,
                stream_id: m.stream_id || m.id,
                container_extension: m.container_extension || 'mp4',
                views: getViewsCount(m.stream_id || m.id, 'movie')
            }));
            movies = [...movies, ...filteredMovies];
            
            const sr = await api(s, 'get_series');
            const filteredSeries = filterAdult(sr).map(x => ({ 
                ...x, 
                server: s,
                series_id: x.series_id || x.id,
                views: getViewsCount(x.series_id || x.id, 'series')
            }));
            series = [...series, ...filteredSeries];
            
            console.log(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${filteredMovies.length} ÙÙŠÙ„Ù… Ùˆ ${filteredSeries.length} Ù…Ø³Ù„Ø³Ù„`);
            
        } catch(e) { 
            console.error('Error loading server:', s.url, e); 
            hasError = true;
        }
    }
    
    if (hasError && movies.length === 0 && series.length === 0) {
        document.getElementById('vodContent').innerHTML = 
            '<div class="vod-error">âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª<br>ØªØ­Ù‚Ù‚ Ù…Ù† Ø§ØªØµØ§Ù„ Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø£Ùˆ Ø­Ø§ÙˆÙ„ Ù„Ø§Ø­Ù‚Ø§Ù‹</div>';
        return;
    }
    
    VOD_DATA = { movieCats, seriesCats, movies, series };
    cache.save();
    updateUI();
    showToast('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
}

function updateUI() {
    const totalMovies = VOD_DATA.movies.length;
    const totalSeries = VOD_DATA.series.length;
    const totalCategories = VOD_DATA.movieCats.length + VOD_DATA.seriesCats.length;
    document.getElementById('vodStats').textContent = `ğŸ“Š ${totalMovies} ÙÙŠÙ„Ù… | ${totalSeries} Ù…Ø³Ù„Ø³Ù„ | ${totalCategories} ØªØµÙ†ÙŠÙ`;
    showVodCategories();
    showVodContent();
}

function showVodCategories() {
    if (currentVodTab === 'favorites' || currentVodTab === 'watchlater') {
        document.getElementById('vodCategories').innerHTML = '';
        return;
    }
    
    const cats = currentVodTab === 'movies' ? VOD_DATA.movieCats : VOD_DATA.seriesCats;
    let html = `<button class="cat-btn ${currentVodCat==='all'?'active':''}" onclick="selectVodCat('all')">ğŸ“ Ø§Ù„ÙƒÙ„</button>`;
    cats.forEach(c => { 
        const id = c.category_id; 
        const name = c.category_name; 
        html += `<button class="cat-btn ${currentVodCat==id?'active':''}" onclick="selectVodCat('${id}')">${name}</button>`; 
    });
    document.getElementById('vodCategories').innerHTML = html;
}

function selectVodCat(id) { 
    currentVodCat = id; 
    currentPage = 1;
    showVodCategories(); 
    showVodContent(); 
}

function switchVodTab(tab) { 
    currentVodTab = tab; 
    currentVodCat = 'all'; 
    currentPage = 1;
    document.getElementById('moviesTab').classList.toggle('active', tab==='movies'); 
    document.getElementById('seriesTab').classList.toggle('active', tab==='series'); 
    document.getElementById('favoritesTab').classList.toggle('active', tab==='favorites'); 
    document.getElementById('watchLaterTab').classList.toggle('active', tab==='watchlater'); 
    showVodCategories(); 
    showVodContent(); 
}

function showVodContent() {
    let items = [];
    
    if (currentVodTab === 'favorites') {
        items = favorites.map(f => f.data);
    } else if (currentVodTab === 'watchlater') {
        items = watchLater.map(w => w.data);
    } else {
        items = currentVodTab === 'movies' ? VOD_DATA.movies : VOD_DATA.series;
        if(currentVodCat !== 'all') items = items.filter(i => i.category_id == currentVodCat);
        if(vodSearchText) { 
            const s = vodSearchText.toLowerCase(); 
            items = items.filter(i => ((i.name||'')+(i.title||'')).toLowerCase().includes(s)); 
        }
    }
    
    const totalItems = items.length;
    const totalPages = Math.ceil(totalItems / itemsPerPage);
    const startIndex = (currentPage - 1) * itemsPerPage;
    const endIndex = startIndex + itemsPerPage;
    const pageItems = items.slice(startIndex, endIndex);
    
    const paginationEl = document.getElementById('pagination');
    paginationEl.style.display = totalPages > 1 ? 'flex' : 'none';
    
    document.getElementById('pageInfo').textContent = `ØµÙØ­Ø© ${currentPage} Ù…Ù† ${totalPages}`;
    document.getElementById('prevPage').disabled = currentPage === 1;
    document.getElementById('nextPage').disabled = currentPage === totalPages;
    
    if(!pageItems.length) { 
        const message = currentVodTab === 'favorites' ? 
            'Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ø­ØªÙˆÙ‰ Ø¥Ù„Ù‰ Ø§Ù„Ù…ÙØ¶Ù„Ø© Ø¨Ø¹Ø¯' : 
            currentVodTab === 'watchlater' ? 
            'Ù„Ù… ØªÙ‚Ù… Ø¨Ø¥Ø¶Ø§ÙØ© Ø£ÙŠ Ù…Ø­ØªÙˆÙ‰ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹ Ø¨Ø¹Ø¯' : 
            'âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø­ØªÙˆÙ‰';
        document.getElementById('vodContent').innerHTML = `<div class="vod-error">${message}</div>`; 
        return; 
    }
    
    let html = '';
    pageItems.forEach(i => {
        const title = i.name || i.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†';
        const img = i.stream_icon || i.cover || '';
        const rating = i.rating || i.rating_5based || '';
        const year = i.year || i.releaseDate || '';
        const views = i.views || 0;
        const isMovie = currentVodTab === 'movies' || (currentVodTab === 'favorites' && i.stream_id) || (currentVodTab === 'watchlater' && i.stream_id);
        const itemType = isMovie ? 'movie' : 'series';
        const isFav = isFavorite(i, itemType);
        const inWatchLater = isInWatchLater(i, itemType);
        
        const itemData = {
            ...i,
            stream_id: i.stream_id || i.id || i.movie_id,
            series_id: i.series_id || i.id,
            container_extension: i.container_extension || (isMovie ? 'mp4' : 'mp4'),
            server: i.server || activeServers[0]
        };
        
        const dataEncoded = encodeURIComponent(JSON.stringify(itemData));
        
        html += `<div class="vod-card" onclick="${isMovie ? `playMovieFromCard('${dataEncoded}')` : `openSeries('${dataEncoded}')`}">`;
        html += `<button class="favorite-btn ${isFav ? 'active' : ''}" onclick="toggleFavorite(event, '${dataEncoded}', '${itemType}')">
                    <i class="fas fa-heart"></i>
                 </button>`;
        html += `<button class="watch-later-btn ${inWatchLater ? 'active' : ''}" onclick="toggleWatchLater(event, '${dataEncoded}', '${itemType}')">
                    <i class="fas fa-clock"></i>
                 </button>`;
        html += `<img src="${img || (isMovie ? 'https://via.placeholder.com/200x300/333/fff?text=ğŸ¬' : 'https://via.placeholder.com/200x300/333/fff?text=ğŸ“º')}" 
                      class="vod-poster" 
                      loading="lazy"
                      onerror="this.src='${isMovie ? 'https://via.placeholder.com/200x300/333/fff?text=ğŸ¬' : 'https://via.placeholder.com/200x300/333/fff?text=ğŸ“º'}'">`;
        html += `<div class="vod-title">${title}</div>`;
        html += `<div class="vod-views">ğŸ‘ï¸ ${views} Ù…Ø´Ø§Ù‡Ø¯Ø©</div>`;
        html += `<div class="vod-info">`;
        html += `<span class="vod-badge">${isMovie ? 'ğŸ¬ ÙÙŠÙ„Ù…' : 'ğŸ“º Ù…Ø³Ù„Ø³Ù„'}</span>`;
        html += `<span class="vod-year">${rating ? 'â­'+rating : ''} ${year}</span>`;
        html += `</div></div>`;
    });
    
    document.getElementById('vodContent').innerHTML = html;
}

function changePage(delta) {
    const totalItems = getFilteredItems().length;
    const totalPages = Math.ceil(totalItems / itemsPerPage);
    
    const newPage = currentPage + delta;
    if (newPage >= 1 && newPage <= totalPages) {
        currentPage = newPage;
        showVodContent();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

function getFilteredItems() {
    if (currentVodTab === 'favorites') {
        return favorites.map(f => f.data);
    }
    
    if (currentVodTab === 'watchlater') {
        return watchLater.map(w => w.data);
    }
    
    let items = currentVodTab === 'movies' ? VOD_DATA.movies : VOD_DATA.series;
    if(currentVodCat !== 'all') items = items.filter(i => i.category_id == currentVodCat);
    if(vodSearchText) { 
        const s = vodSearchText.toLowerCase(); 
        items = items.filter(i => ((i.name||'')+(i.title||'')).toLowerCase().includes(s)); 
    }
    return items;
}

// ==================== ØªØ´ØºÙŠÙ„ Ø§Ù„Ø£ÙÙ„Ø§Ù… ÙˆØ§Ù„Ù…Ø³Ù„Ø³Ù„Ø§Øª ====================
async function playMovieFromCard(encoded) {
    try {
        const i = JSON.parse(decodeURIComponent(encoded));
        console.log('Movie data:', i);
        
        const streamId = i.stream_id || i.id || i.movie_id;
        const server = i.server || activeServers[0];
        
        if (!streamId) {
            showToast('Ù…Ø¹Ø±Ù Ø§Ù„ÙÙŠÙ„Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯', 'error');
            return;
        }
        
        if (!server || !server.url || !server.user || !server.pass) {
            showToast('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ±ÙØ± ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©', 'error');
            return;
        }
        
        // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª
        incrementViews(streamId, 'movie');
        
        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
        setTimeout(() => {
            showVodContent();
        }, 100);
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        const modal = document.getElementById('hlsPlayerModal');
        const video = document.getElementById('hlsVideoPlayer');
        
        modal.style.display = 'flex';
        video.pause();
        video.currentTime = 0;
        video.src = '';
        
        // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± ØªØ­Ù…ÙŠÙ„
        const loadingDiv = document.createElement('div');
        loadingDiv.id = 'playerLoading';
        loadingDiv.style.cssText = `
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            text-align: center;
            z-index: 10;
        `;
        loadingDiv.innerHTML = '<div class="spinner"></div><br>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
        document.querySelector('.hls-player-content').appendChild(loadingDiv);
        
        // Ù…Ø­Ø§ÙˆÙ„Ø© ØªØ´ØºÙŠÙ„ Ø§Ù„Ø±Ø§Ø¨Ø· Ù…Ø¨Ø§Ø´Ø±Ø©
        let videoUrl;
        let attempts = 0;
        
        // ØªØ¬Ø±Ø¨Ø© Ø¹Ø¯Ø© ØµÙŠØº Ù„Ù„Ø±ÙˆØ§Ø¨Ø·
        const urlFormats = [
            `${server.url}/movie/${server.user}/${server.pass}/${streamId}.mp4`,
            `${server.url}/movie/${server.user}/${server.pass}/${streamId}.mkv`,
            `${server.url}/movie/${server.user}/${server.pass}/${streamId}.m3u8`,
            `${server.url}/movie/${server.user}/${server.pass}/${streamId}`,
            `${server.url}/play/${server.user}/${server.pass}/${streamId}`,
            `${server.url}/live/${server.user}/${server.pass}/${streamId}.m3u8`
        ];
        
        async function tryPlay() {
            if (attempts >= urlFormats.length) {
                showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· ØªØ´ØºÙŠÙ„ ØµØ§Ù„Ø­', 'error');
                closeHlsPlayer();
                loadingDiv.remove();
                return;
            }
            
            videoUrl = urlFormats[attempts];
            console.log(`Ø¬Ø±Ø¨ Ø±Ø§Ø¨Ø· ${attempts + 1}:`, videoUrl);
            
            try {
                if (Hls.isSupported()) {
                    if (hls) hls.destroy();
                    
                    hls = new Hls({
                        enableWorker: true,
                        lowLatencyMode: true,
                        backBufferLength: 90,
                        manifestLoadingTimeOut: 10000,
                        manifestLoadingMaxRetry: 3,
                        levelLoadingTimeOut: 10000,
                        levelLoadingMaxRetry: 3,
                        fragLoadingTimeOut: 10000,
                        fragLoadingMaxRetry: 3,
                        startLevel: -1,
                        capLevelToPlayerSize: true
                    });
                    
                    hls.loadSource(videoUrl);
                    hls.attachMedia(video);
                    
                    hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        console.log('HLS manifest loaded successfully');
                        loadingDiv.remove();
                        video.play().catch(e => {
                            console.error('Auto-play failed:', e);
                            showToast('Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ù„Ù„Ø¨Ø¯Ø¡', 'info');
                        });
                        showCloseButton();
                    });
                    
                    hls.on(Hls.Events.ERROR, function(event, data) {
                        console.error('HLS error:', data);
                        
                        if (data.fatal) {
                            hls.destroy();
                            attempts++;
                            setTimeout(tryPlay, 500);
                        }
                    });
                    
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    // Ù„Ù…ØªØµÙØ­Ø§Øª iOS Ùˆ Safari
                    video.src = videoUrl;
                    video.addEventListener('loadedmetadata', function() {
                        loadingDiv.remove();
                        video.play().catch(e => {
                            console.error('Auto-play failed:', e);
                            showToast('Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ù„Ù„Ø¨Ø¯Ø¡', 'info');
                        });
                        showCloseButton();
                    });
                    
                    video.addEventListener('error', function(e) {
                        console.error('Video element error:', e);
                        attempts++;
                        setTimeout(tryPlay, 500);
                    });
                }
                
            } catch (error) {
                console.error('Playback attempt error:', error);
                attempts++;
                setTimeout(tryPlay, 500);
            }
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
        tryPlay();
        
    } catch(e) { 
        console.error('Error playing movie:', e);
        showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„ÙÙŠÙ„Ù…', 'error'); 
    }
}

async function openSeries(encoded) {
    try {
        const series = JSON.parse(decodeURIComponent(encoded));
        const modal = document.getElementById('episodeModal');
        const server = series.server || activeServers[0];
        
        if (!server || !series.series_id) {
            showToast('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³Ù„Ø³Ù„ ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©', 'error');
            return;
        }
        
        modal.style.display = 'flex';
        document.getElementById('modalTitle').textContent = 'â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ' + (series.name || series.title);
        document.getElementById('seasons').innerHTML = '';
        document.getElementById('episodes').innerHTML = '<div class="vod-loading"><div class="spinner"></div></div>';
        
        const info = await getSeriesInfo(server, series.series_id);
        if(!info || !info.episodes) {
            document.getElementById('episodes').innerHTML = '<div class="vod-error">âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù„Ù‚Ø§Øª</div>';
            return;
        }
        
        document.getElementById('modalTitle').textContent = 'ğŸ“º ' + (series.name || series.title);
        const seasons = Object.keys(info.episodes).sort((a,b)=>a-b);
        let seasonsHtml = '';
        seasons.forEach((s, idx) => { 
            seasonsHtml += `<button class="season-btn ${idx===0?'active':''}" onclick="showEpisodes(this, '${encodeURIComponent(JSON.stringify(info.episodes[s]))}', '${server.url}', '${server.user}', '${server.pass}')">Ø§Ù„Ù…ÙˆØ³Ù… ${s}</button>`; 
        });
        document.getElementById('seasons').innerHTML = seasonsHtml;
        
        if(seasons.length>0) {
            showEpisodes(document.querySelector('.season-btn'), encodeURIComponent(JSON.stringify(info.episodes[seasons[0]])), server.url, server.user, server.pass);
        }
    } catch(e) {
        console.error('Error opening series:', e);
        showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³Ù„Ø³Ù„', 'error');
    }
}

function showEpisodes(btn, encodedEpisodes, url, user, pass) {
    try {
        if(btn && btn.tagName === 'BUTTON') {
            document.querySelectorAll('.season-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
        
        const episodes = JSON.parse(decodeURIComponent(encodedEpisodes || '[]'));
        let html = '';
        (episodes||[]).forEach(ep => {
            const epId = ep.id || ep.episode_num;
            if (!epId) return;
            
            const epNum = ep.episode_num || ep.title || ep.id;
            const title = ep.title || `Ø§Ù„Ø­Ù„Ù‚Ø© ${epNum}`;
            html += `<button class="ep-btn" onclick="playEpisode('${epId}','${url}','${user}','${pass}','${title}')">ğŸ¬ ${epNum}</button>`;
        });
        document.getElementById('episodes').innerHTML = html || '<div class="vod-error">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ù„Ù‚Ø§Øª</div>';
    } catch(e) {
        console.error('Error showing episodes:', e);
        document.getElementById('episodes').innerHTML = '<div class="vod-error">Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ù„Ù‚Ø§Øª</div>';
    }
}

async function playEpisode(epId, url, user, pass, title) {
    try {
        // Ø¥Ø¸Ù‡Ø§Ø± Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
        const modal = document.getElementById('hlsPlayerModal');
        const video = document.getElementById('hlsVideoPlayer');
        
        modal.style.display = 'flex';
        video.pause();
        video.currentTime = 0;
        video.src = '';
        
        // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± ØªØ­Ù…ÙŠÙ„
        const loadingDiv = document.createElement('div');
        loadingDiv.id = 'playerLoading';
        loadingDiv.style.cssText = `
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            text-align: center;
            z-index: 10;
        `;
        loadingDiv.innerHTML = '<div class="spinner"></div><br>Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...';
        document.querySelector('.hls-player-content').appendChild(loadingDiv);
        
        // Ø²ÙŠØ§Ø¯Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø´Ø§Ù‡Ø¯Ø§Øª
        incrementViews(epId, 'series');
        
        // ØªØ¬Ø±Ø¨Ø© Ø¹Ø¯Ø© ØµÙŠØº Ù„Ù„Ø±ÙˆØ§Ø¨Ø·
        const urlFormats = [
            `${url}/series/${user}/${pass}/${epId}.m3u8`,
            `${url}/series/${user}/${pass}/${epId}`,
            `${url}/${user}/${pass}/${epId}`,
            `${url}/play/${user}/${pass}/${epId}.m3u8`,
            `${url}/stream/${user}/${pass}/${epId}.m3u8`
        ];
        
        let attempts = 0;
        
        async function tryPlay() {
            if (attempts >= urlFormats.length) {
                showToast('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø±Ø§Ø¨Ø· ØªØ´ØºÙŠÙ„ ØµØ§Ù„Ø­', 'error');
                closeHlsPlayer();
                loadingDiv.remove();
                return;
            }
            
            const videoUrl = urlFormats[attempts];
            console.log(`Ø¬Ø±Ø¨ Ø±Ø§Ø¨Ø· Ø§Ù„Ø­Ù„Ù‚Ø© ${attempts + 1}:`, videoUrl);
            
            try {
                if (Hls.isSupported()) {
                    if (hls) hls.destroy();
                    
                    hls = new Hls({
                        enableWorker: true,
                        lowLatencyMode: true,
                        backBufferLength: 90,
                        manifestLoadingTimeOut: 10000,
                        manifestLoadingMaxRetry: 3,
                        levelLoadingTimeOut: 10000,
                        levelLoadingMaxRetry: 3,
                        fragLoadingTimeOut: 10000,
                        fragLoadingMaxRetry: 3,
                        startLevel: -1,
                        capLevelToPlayerSize: true
                    });
                    
                    hls.loadSource(videoUrl);
                    hls.attachMedia(video);
                    
                    hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        console.log('HLS manifest loaded successfully');
                        loadingDiv.remove();
                        video.play().catch(e => {
                            console.error('Auto-play failed:', e);
                            showToast('Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ù„Ù„Ø¨Ø¯Ø¡', 'info');
                        });
                        showCloseButton();
                        closeEpisodeModal();
                    });
                    
                    hls.on(Hls.Events.ERROR, function(event, data) {
                        console.error('HLS error:', data);
                        
                        if (data.fatal) {
                            hls.destroy();
                            attempts++;
                            setTimeout(tryPlay, 500);
                        }
                    });
                    
                } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                    video.src = videoUrl;
                    video.addEventListener('loadedmetadata', function() {
                        loadingDiv.remove();
                        video.play().catch(e => {
                            console.error('Auto-play failed:', e);
                            showToast('Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø²Ø± Ø§Ù„ØªØ´ØºÙŠÙ„ Ù„Ù„Ø¨Ø¯Ø¡', 'info');
                        });
                        showCloseButton();
                        closeEpisodeModal();
                    });
                    
                    video.addEventListener('error', function(e) {
                        console.error('Video element error:', e);
                        attempts++;
                        setTimeout(tryPlay, 500);
                    });
                }
                
            } catch (error) {
                console.error('Playback attempt error:', error);
                attempts++;
                setTimeout(tryPlay, 500);
            }
        }
        
        // Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
        tryPlay();
        
    } catch(e) {
        console.error('Error playing episode:', e);
        showToast('Ø®Ø·Ø£ ÙÙŠ ØªØ´ØºÙŠÙ„ Ø§Ù„Ø­Ù„Ù‚Ø©', 'error');
    }
}

function closeEpisodeModal() { 
    document.getElementById('episodeModal').style.display = 'none'; 
}

// ==================== Ø§Ù„Ø¨Ø­Ø« ÙÙŠ VOD ====================
document.getElementById('vodSearchInput').addEventListener('input', e => { 
    clearTimeout(searchTimeout);
    searchTimeout = setTimeout(() => { 
        vodSearchText = e.target.value; 
        currentPage = 1;
        showVodContent(); 
    }, 300);
});

// ==================== Ù…Ø³Ø­ Ø§Ù„ÙƒØ§Ø´ ====================
function clearCache() {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒØ§Ø´ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ø³ÙŠØ¹Ø§Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ Ø²ÙŠØ§Ø±ØªÙƒ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.')) {
        localStorage.removeItem('vodCache');
        cache.data = null;
        cache.timestamp = 0;
        VOD_DATA = { movieCats: [], seriesCats: [], movies: [], series: [] };
        showToast('ØªÙ… Ù…Ø³Ø­ ÙƒØ§Ø´ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª', 'info');
    }
}

function clearImageCache() {
    if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒØ§Ø´ Ø§Ù„ØµÙˆØ±ØŸ Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ± Ù…Ù† Ø¬Ø¯ÙŠØ¯ Ø¹Ù†Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©.')) {
        imageCacheManager.clearCache();
        showToast('ØªÙ… Ù…Ø³Ø­ ÙƒØ§Ø´ Ø§Ù„ØµÙˆØ±', 'info');
        setTimeout(() => {
            location.reload();
        }, 1000);
    }
}

// ==================== ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© ====================
window.onload = function() {
    // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨Ø§Ù„Ø³Ø­Ø¨
    disableSwipeNavigation();
    
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©
    loadWatchLater();
    loadViews();
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    initHomePage();
    
    // ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø§ØµØ± ØªØ­ÙƒÙ… Ù…Ø´ØºÙ„ HLS
    initHlsControls();
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø¨Ø­Ø«
    document.getElementById('vodSearchInput').addEventListener('focus', function() {
        if(VOD_DATA.movies.length === 0) {
            loadAllVod();
        }
    });
    
    // ØªØ­Ù…ÙŠÙ„ VOD Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„ØµÙØ­Ø© Ù†Ø´Ø·Ø©
    const currentTab = document.querySelector('.tab-btn.active');
    if (currentTab && currentTab.dataset.target === 'vod-page') {
        setTimeout(() => {
            if(VOD_DATA.movies.length === 0) {
                loadAllVod();
            }
        }, 500);
    }
};

document.getElementById('episodeModal').addEventListener('click', e => { 
    if(e.target.id === 'episodeModal') closeEpisodeModal(); 
});
</script> 
</body> 
</html>